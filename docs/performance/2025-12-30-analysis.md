# Relatório de Análise de Performance: Journal-NextJs

## Resumo Executivo

A análise dos traces revela problemas críticos de **bloqueio da Main Thread** em todas as páginas, resultando em interações lentas (TBT elevado). O **Dashboard** é o caso mais grave, com um LCP inaceitável de **31.7s**, tornando-o inutilizável até o carregamento tardio. A página de **Login**, embora carregue visualmente rápido (LCP 0.8s), sofre de instabilidade visual (CLS) e lentidão na interatividade.

**Principais Gargalos:**

1.  **Bloqueio Severo da Main Thread (TBT)**: Scripts JavaScript (Hydration/Execution) estão travando o navegador por 3 a 6 segundos.
2.  **LCP Tardio no Dashboard**: O conteúdo principal demora 31s para ser identificado, sugerindo rendering bloqueante ou waterfalls de dados extremos.
3.  **CLS no Login**: Shifts de layout que prejudicam a percepção de qualidade.

---

## Análise por Página

### 1. Root / Home (`Trace-root.json`)

- **Tempo Total Trace**: 9.28s
- **LCP (Largest Contentful Paint)**: `2.3s` (Aceitável, limite de 2.5s)
- **TBT (Total Blocking Time)**: `3,169ms` (:rotating_light: **Crítico** - Ideal < 300ms)
- **Long Tasks**: 29 tarefas longas (>50ms).
- **Diagnóstico**: A página carrega o visual rapidamente, mas o usuário não consegue interagir fluidamente por mais de 3 segundos devido à execução pesada de JS (Hydration).

### 2. Dashboard (`Trace-dashboard.json`)

- **Tempo Total Trace**: 39.3s
- **LCP**: `31,754ms` (:rotating_light: **Catastrófico**)
- **TBT**: `6,530ms` (:rotating_light: **Extremo**)
- **Long Tasks**: 52 tarefas longas.
- **Diagnóstico**: O Dashboard é o ponto mais fraco. O LCP de 31s indica que o maior elemento visível ou só aparece no final ou é carregado muito tardiamente (ex: imagem pesada ou dados via client-side fetch em cascata). O bloqueio de 6.5s torna a interface "congelada" durante o carregamento.

### 3. Login (`Trace-login.json`)

- **Tempo Total Trace**: 9.3s
- **LCP**: `835ms` (:white_check_mark: **Excelente**)
- **CLS (Cumulative Layout Shift)**: `0.1373` (:warning: **Atenção** - Ideal < 0.1)
- **TBT**: `2,811ms` (:rotating_light: **Crítico**)
- **Diagnóstico**: Visualmente rápida, mas com saltos de layout (CLS). TBT ainda muito alto para uma página simples de login, indicando bundles desnecessários sendo carregados ou validações pesadas.

---

## Comparação Root vs Dashboard

| Métrica        | Root (Home) | Dashboard | Veredito                                                   |
| :------------- | :---------- | :-------- | :--------------------------------------------------------- |
| **LCP**        | 2.3s        | **31.7s** | Dashboard é 13x mais lento para exibir conteúdo principal. |
| **TBT**        | 3.2s        | **6.5s**  | Dashboard trava a interface pelo dobro do tempo.           |
| **Long Tasks** | 29          | 52        | Dashboard realiza muito mais trabalho na Main Thread.      |

**Conclusão**: O Dashboard sofre de complexidade excessiva no cliente ou problemas graves de data-fetching que não ocorrem na Home.

---

## Causa Raiz e Soluções Práticas

### 1. Causa: TBT Elevado (High Main Thread Work)

- **O que é**: O navegador passa tempo demais executando JavaScript (Hydration, Effects) em vez de responder ao usuário.
- **Solução: Code Splitting e Lazy Loading**
  Reduza o bundle inicial movendo componentes pesados para carregamento sob demanda.

  ```tsx
  // Antes
  import HeavyChart from "@/components/HeavyChart";

  // Depois (Lazy Load)
  import dynamic from "next/dynamic";
  const HeavyChart = dynamic(() => import("@/components/HeavyChart"), {
    loading: () => <p>Carregando gráfico...</p>,
    ssr: false, // Se não for crítico para SEO
  });
  ```

### 2. Causa: LCP Gigante no Dashboard (31s)

- **O que é**: O elemento principal demora a aparecer. Possivelmente dados sendo buscados no cliente (useEffect) após o carregamento da página, criando uma cascata (Waterfall).
- **Solução: Server Components e Streaming**
  Mova o data fetching para o servidor. Use `Suspense` para mostrar UI instantânea enquanto dados carregam.

  ```tsx
  // app/dashboard/page.tsx
  import { Suspense } from "react";
  import DashboardMetrics from "./metrics";

  export default function Dashboard() {
    return (
      <main>
        <h1>Meu Painel</h1>
        <Suspense fallback={<MetricsSkeleton />}>
          {/* Componente busca dados no servidor (async/await) */}
          <DashboardMetrics />
        </Suspense>
      </main>
    );
  }
  ```

### 3. Causa: CLS no Login (0.137)

- **O que é**: Elementos mudando de posição. Comum em formulários com mensagens de erro que "empurram" o conteúdo ou imagens sem dimensões.
- **Solução: Reserve Espaço e Dimensões Fixas**

  ```tsx
  // Evite layout shift reservando altura para mensagens de erro
  <div style={{ minHeight: "24px" }} className="text-red-500">
    {state.error || ""}
  </div>;

  // Use Next/Image com dimensões
  import Image from "next/image";
  <Image src="/logo.png" width={200} height={50} alt="Logo" />;
  ```

---

## Plano de Ação Priorizado

### 1. Quick Wins (Impacto Imediato)

1.  [ ] **Corrigir CLS no Login**: Fixar altura de containers de erro e inputs.
2.  [ ] **Lazy Load de Componentes não visíveis**: Modais e componentes "abaixo da dobra" no Dashboard e Home.

### 2. Médio Prazo (Resolução de TBT)

1.  [ ] **Otimizar Bundle Size**: Usar `@next/bundle-analyzer` para achar libs grandes (ex: moment.js, lodash) e substituir por equivalentes leves.
2.  [ ] **Memoization**: Revisar componentes que re-renderizam excessivamente usando `React.memo` ou `useMemo` em listas grandes.

### 3. Estrutural (Resolução de LCP Dashboard)

1.  [ ] **Migrar Fetching para Server Actions/RSC**: Eliminar `useEffect` para busca de dados inicial no Dashboard. Trazer dados no servidor e passar via props ou usar `use` em componentes filhos.

## Métricas Esperadas Pós-Otimização

- **LCP Dashboard**: < 2.5s (Redução de 90%)
- **TBT Geral**: < 1.0s (Redução de 60%)
- **CLS Login**: 0 (Zero layout shift)
